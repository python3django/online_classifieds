{% extends "base.html" %}
{% load static %}

{% block title %}
  {% if rubric %}{{ rubric.name }}{% else %}Сайт объявлений{% endif %}
{% endblock %}

{% block content %}
  <div id="sidebar">
    <h3>Рубрики</h3>
    <ul>
      <li {% if not rubric %}class="selected"{% endif %}>
        <a href="{% url "classifieds:note_list" %}">Все</a>
      </li>
      {% if rubrics %}
          {% for r in rubrics %}
            <li><a href="{{ r.get_absolute_url }}">{{ r.name }}</a></li>
          {% endfor %}
      {% elif categories %}
        <li {% if rubric.name %}class="selected"{% endif %}>
            <a href="{{ rubric.get_absolute_url }}">{{ rubric.name }}</a>
        </li>
        {% for c in categories %}
            <li><a href="{{ c.get_absolute_url }}">&nbsp;&nbsp;{{ c.name }}</a></li>
        {% endfor %}
      {% elif subcategories %}
        <li><a href="{{ rubric.get_absolute_url }}">{{ rubric.name }}</a></li>
            <li {% if category.name %}class="selected"{% endif %}>
                <a href="{{ category.get_absolute_url }}">&nbsp;&nbsp;{{ category.name }}</a>
            </li>
            {% for s in subcategories %}
                <li>
                    <a href="{{ s.get_absolute_url }}">&nbsp;&nbsp;&nbsp;&nbsp;{{ s.name }}</a>
                </li>
            {% endfor %}
      {% endif %}

      {% if subcategory %}
        <li><a href="{{ rubric.get_absolute_url }}">{{ rubric.name }}</a></li>
        <li><a href="{{ category.get_absolute_url }}">&nbsp;&nbsp;{{ category.name }}</a></li>
        <li class="selected"><a href="{{ subcategory.get_absolute_url }}">&nbsp;&nbsp;&nbsp;&nbsp;{{ subcategory.name }}</a></li>
      {% endif %}

    </ul>
  </div>

  <div id="main" class="note-list">
    <h1>
        {% if rubric %}
            <a href="{{ rubric.get_absolute_url }}">{{ rubric.name }}</a>
            {% if category %}
                &rarr;<a href="{{ category.get_absolute_url }}">{{ category.name }}</a>
                {% if subcategory %}
                    &rarr;<a href="{{ subcategory.get_absolute_url }}">{{ subcategory.name }}</a>
                {% endif %}
            {% endif %}
        {% endif %}
    </h1>
    {% for note in notes %}
      <div class="item">
        <a href="{{ note.get_absolute_url }}">
          {% with note.images.all as imgs %}
            {% for image in imgs|dictsortreversed:"main" %}
                {% if forloop.first %}
                    <img src="{{ image.get_absolute_url }}" style="height: 100px; width: 100px;">
                {% endif %}
            {% empty %}
                <img src="{% static "img/no_image.png" %}" style="height: 100px; width: 100px;">
            {% endfor %}
          {% endwith %}
        </a><br>
        <span>{{ note.updated|date:"j M Y" }}</span><br>
        <span>{{ note.updated|time }}</span><br>
        <a href="{{ note.get_absolute_url }}">{{ note.name|truncatechars:11 }}</a><br>
        ${{ note.price }}
      </div>
    {% endfor %}
  </div>
  
  {% include "pagination.html" with page=notes %}

{% endblock %}
