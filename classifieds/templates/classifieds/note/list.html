{% extends "base.html" %}
{% load static %}

{% block title %}
  {% if category %}{{ category.name }}{% else %}Сайт объявлений{% endif %}
{% endblock %}

{% block content %}
  <div id="sidebar">
    <h3>Категории</h3>
    <ul>
      <li {% if not category %}class="selected"{% endif %}>
        <a href="{% url "classifieds:note_list" %}">Все</a>
      </li>
      {% if categories %}
          {% for c in categories %}
            <li {% if category.slug == c.slug %}class="selected"{% endif %}>
              <a href="{{ c.get_absolute_url }}">{{ c.name }}</a>
            </li>
          {% endfor %}
      {% endif %}
      
      {% if subcategories %}
        <li {% if category.name %}class="selected"{% endif %}>
            <a href="{{ category.get_absolute_url }}">{{ category.name }}</a>
        </li>
        <ul>
          {% for s in subcategories %}
            <li {% if subcategory.slug == s.slug %}class="selected"{% endif %}>
              <a href="{{ s.get_absolute_url }}">&nbsp;&nbsp;{{ s.name }}</a>
            </li>
          {% endfor %}
        </ul>
      {% endif %}

      {% if subcategory %}
        <li><a href="{{ category.get_absolute_url }}">{{ category.name }}</a></li>
        <li class="selected"><a href="{{ subcategory.get_absolute_url }}">&nbsp;&nbsp;{{ subcategory.name }}</a></li>
      {% endif %}

    </ul>
  </div>

  <div id="main" class="note-list">
    <h1>
        {% if category %}
            <a href="{{ category.get_absolute_url }}">{{ category.name }}</a>
            {% if subcategory %}
                &nbsp;>&nbsp;<a href="{{ subcategory.get_absolute_url }}">{{ subcategory.name }}</a>
            {% endif %}
        {% endif %}
    </h1>
    {% for note in notes %}
      <div class="item">
        <a href="{{ note.get_absolute_url }}">
          {% with note.images.all as imgs %}
            {% for image in imgs|dictsortreversed:"main" %}
                {% if forloop.first %}
                    <img src="{{ image.get_absolute_url }}" style="height: 100px; width: 100px;">
                {% endif %}
            {% empty %}
                <img src="{% static "img/no_image.png" %}" style="height: 100px; width: 100px;">
            {% endfor %}
          {% endwith %}
        </a><br>
        <span>{{ note.updated|date:"j M Y" }}</span><br>
        <span>{{ note.updated|time }}</span><br>
        <a href="{{ note.get_absolute_url }}">{{ note.name|truncatechars:11 }}</a><br>
        ${{ note.price }}
      </div>
    {% endfor %}
  </div>
 
  {% include "pagination.html" with page=notes %}

{% endblock %}
